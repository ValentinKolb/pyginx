
# [ debug | info | notice | warn | error | crit ]
error_log  /var/log/example.com.nginx.error_log  warn;

events {
}

http {
    # Connection Upgrade For Websocket Support
    map $http_upgrade $connection_upgrade {
        default upgrade;
        '' close;
    }
        
    # Upstreams
    upstream backend {
        # no load balancing method is specified for Round Robin;
        server localhost:81;
    }

    # HTTP(S) Servers
    server {

        listen 80;
        listen [::]:80;

        # Domain Of The Service
        server_name             example.com;

        # HSTS
        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

        # Use Newest TLS Version
        ssl_protocols           TLSv1.3;

        # Locations
        location  /  {
            proxy_pass      http://;

            client_max_body_size        1MB;        # allow big file uploads eg. 20G

            # Websocket Support
            proxy_http_version  1.1;                                                    # use http version that supports websockets
            proxy_set_header    X-Real-IP           $remote_addr;                       # change the ip in the forwarded header to be the client ip, not the proxy ip
            # proxy_set_header  X-Forwarded-For     $proxy_add_x_forwarded_for;         # client gets request ip
            proxy_set_header    Host                $host;                              # sets host header to the addr of the nginx proxy
            proxy_set_header    Upgrade             $http_upgrade;                      # upgrades the connection
            proxy_set_header    Connection          $connection_upgrade;                # ensures the connection is upgraded
        }
    }
}